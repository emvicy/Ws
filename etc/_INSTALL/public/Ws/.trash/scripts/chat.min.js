(function(){document.addEventListener("DOMContentLoaded",()=>{const elLog=document.getElementById('log');const elStatus=document.getElementById('status');const elSend=document.getElementById('send');const elData=document.getElementById('data');const log=(msg)=>{elLog.insertAdjacentHTML('afterbegin',`${msg}<br />`);};let socket=null;let serverUrl='ws://127.0.0.1:8000/chat';if(window.MozWebSocket){socket=new MozWebSocket(serverUrl);}else if(window.WebSocket){socket=new WebSocket(serverUrl);}
socket.binaryType='blob';socket.onopen=(msg)=>{elStatus.classList.remove('offline');elStatus.classList.add('online');elStatus.innerText='connected';};socket.onmessage=(msg)=>{let response=JSON.parse(msg.data);log(response.data);};socket.onclose=(msg)=>{elStatus.classList.remove('online');elStatus.classList.add('offline');elStatus.innerText='disconnected';};elStatus.addEventListener('click',()=>{socket.close();});elSend.addEventListener('click',()=>{let payload={action:'echo',data:elData.value};socket.send(JSON.stringify(payload));});elData.addEventListener('keyup',(evt)=>{if(evt.code!=='Enter'){return;}
let payload={action:'echo',data:elData.value};socket.send(JSON.stringify(payload));elData.value='';});});}).call();